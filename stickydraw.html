<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  stroke: #000;
  stroke-width: 1.5px;
}

.node {
  cursor: move;
  fill: #000;
  stroke: #000;
  stroke-width: 1.5px;
}

.node.fixed {
	stroke: #f00;
}

.drawingboard {
	stroke: #000;
}

</style>
<body>
<script src="d3.min.js"></script>
<script>

var width = 1300,
    height = 700;

var color = d3.scale.category10();

var nodes = [],
    links = [];

var force = d3.layout.force()
    .nodes(nodes)
    .links(links)
    .charge(-400)
    .gravity(.1)
    .linkDistance(120)
    .size([width, height])
    .on("tick", tick);

var svg = d3.select("body").append("svg")
	.classed("drawingboard", true)
    .attr("width", width)
    .attr("height", height);

var node = svg.selectAll(".node"),
    link = svg.selectAll(".link");

var drag = force.drag()
		.on("dragstart", dragstart);

// 1. Add three nodes and three links.
// setTimeout(function() {
//   var a = {id: 0}, b = {id: 1}, c = {id: 2};
//   nodes.push(a, b, c);
//   links.push({source: nodes[0], target: nodes[1]}, {source: a, target: c}, {source: b, target: c});
//   start();
// }, 0);

// 2. Remove node B and associated links.
// setTimeout(function() {
//   nodes.splice(1, 1); // remove b
//   links.shift(); // remove a-b
//   links.pop(); // remove b-c
//   start();
// }, 3000);

// Add node B back.
// setTimeout(function() {
//   var a = nodes[0], b = {id: "b"}, c = nodes[1];
//   nodes.push(b);
//   links.push({source: a, target: b}, {source: b, target: c});
//   start();
// }, 6000);

function dblclick(d) {
	d3.select(this).classed("fixed", d.fixed = false);
	force.resume();
}

function dragstart(d) {
	d3.select(this).classed("fixed", d.fixed = true);
}

function start() {
  link = link.data(force.links(), function(d) { console.debug(d); console.debug(d.target); return d.source.id + "-" + d.target.id; });
  link.enter().insert("line", ".node").attr("class", "link");
  link.exit().remove();

  node = node.data(force.nodes(), function(d) { return d.id;});
  node.enter().append("circle").attr("class", function(d) { return "node " + d.id; }).attr("r", 8).on("dblclick", dblclick).call(drag);
  node.exit().remove();

  force.start();
}

function tick() {
  node.attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; })

  link.attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });
}


function load_g6(form)
{
	var g6string=form.g6.value;
	var g6i=0;
	var i, j, k, x;
	
	// if (*g6 == ':')
// 	{
// 		alert("Cannot read sparse6 format\n");
// 		return false;
// 	}
	
	var nv = g6string.charCodeAt(g6i) - 63;
	nodes.length=0;
	links.length=0;

	for (i=0; i<nv; i++)
	{
		nodes[i]={id:i};
	}
	g6i++;
	
// 	if (g->nv > SMALLN) {
// 		for (i = 0, g->nv = 0; i < 3; ++i) {
// 			g->nv = (g->nv << 6) | (*g6++ -BIAS6);
// 		}
// 	}

// 	if (g->nv >= MAXNV)
// 	{
// 		fprintf(stderr, "Graph of size %d is larger than maximum size %d\n", g->nv, MAXNV);
// 		exit(1);
// 	}
	k = 1
	for (i = 1; i < nv; i++)
	{
		for (j = 0; j < i; j++)
		{
			k--;
			if (k==0)
			{
				k = 6;
				x = g6string.charCodeAt(g6i) - 63;
				g6i++;
			}
			if ((x >> 5) & 1)
			{
				links.push({source:nodes[i], target:nodes[j]});
				console.debug(""+i+","+j);
			}
			x <<= 1;
		}
	}
	svg.selectAll(".fixed").classed("fixed", false);
	start();
	
 	return false;
}


</script>

<form action="" onsubmit="return load_g6(this)&&false;">
Graph6: <input type="text" name="g6" value=""><br>
<input type="submit" value="Submit">
</form>
<body>